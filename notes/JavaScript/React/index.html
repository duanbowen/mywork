<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>react ç»„ä»¶æ€æƒ³</title>
</head>
<body>
    
    <div id="root">

    </div>

    <script type="text/javascript">
        
        // ä»…ä»…å°±æ˜¯åˆ›å»ºä¸€ä¸ªdiv æ ‡ç­¾
        const createDOMFromString = (domString) => { 
            const div = document.createElement('div')
            div.innerHTML = domString 
            return div 
        }

        // root èŠ‚ç‚¹
        const wrapper = document.querySelector('#root');

        //çˆ¶ç»„ä»¶ 
        class Component {
            constructor(props = {}){
                this.props = props;
            }

            // ç»„ä»¶çš„çŠ¶æ€æ”¹å˜æ—¶ å…ˆæ›´æ–°ç»„ä»¶ç„¶åé‡æ–°æ’å…¥æ­¤èŠ‚ç‚¹
            setState(state){
                //åªè¦çŠ¶æ€æ”¹å˜å°±é‡æ–°æ’å…¥ç»“æ„
                const oldEl = this.el;
                this.state = state;
                this.el = this._renderDOM();

                if(this.onStateChange){
                    this.onStateChange(oldEl,this.el)
                }

            }

            _renderDOM(){
                console.log(this);
                this.el = createDOMFromString(this.render());
                // å¦‚æœå­ç±»æœ‰onclickæ–¹æ³•
                if(this.onClick){
                    this.el.addEventListener('click',this.onClick.bind(this),false);
                }
                return this.el
            }
        }

        class MyButton extends Component{
            constructor(props){
                super(props)
                this.state = {isLiked : false}
            }

            onClick(){
                this.setState({
                    isLiked:!this.state.isLiked
                })
            }
            render(){
                return `
                <button class='like-btn' style="background-color: ${this.props.bgColor}">
                <span class='like-text'>${this.state.isLiked ? 'å–æ¶ˆ' : 'ç‚¹èµ'}
                </span>
                <span>ğŸ‘</span>
                </button>
                `
            }
        }

        // 
        const mount = (component,wrapper) => {
             wrapper.appendChild(component._renderDOM())
             component.onStateChange = (oldEl,newEl)=>{
                 wrapper.insertBefore(newEl,oldEl)
                 wrapper.removeChild(oldEl)
             }
        }

        mount(new MyButton({bgColor:'red'}),wrapper)
        // class LikeButton {
        //     constructor (){
        //         this.state = { isLiked:false}
        //     }

        //     setState(state){

        //         const oldEL = this.el;
        //         this.state = state;
        //         //console.log(this.state.isLiked.toString());
        //         this.el = this.render()

        //         //console.log(this.el);

        //         if(this.onStateChange) this.onStateChange(oldEL,this.el)
        //     }

        //     changeLikeText(){
                
        //         //å‡å°‘domæ“ä½œ  é‡æ–°ç”Ÿæˆæ–°çš„domç»“æ„æ›¿ä»£

        //         // const likeText = this.el.querySelector('.like-text')
        //         // this.state.isLiked = !this.state.isLiked
        //         // likeText.innerHTML = this.state.isLiked ? 'å–æ¶ˆ' : 'ç‚¹èµ'
        //         this.setState({
        //             isLiked:!this.state.isLiked
        //         })

        //     }
        //     render(){
        //         this.el = createDOMFromString(`<button class='like-button'>
        //         <span class='like-text'>${this.state.isLiked ? 'å–æ¶ˆ' : 'ç‚¹èµ'}</span>
        //         <span>ğŸ‘</span>
        //         </button>`)
        //         this.el.addEventListener('click', this.changeLikeText.bind(this), false)
        //         return this.el
        //     }
        // }

        //   const likeButton = new LikeButton() 
        // wrapper.appendChild(likeButton.render()) //ç¬¬ä¸€æ¬¡æ’å…¥dom
        
        // // onstateChangeå‡½æ•°å®ç°åœ¨è¿™é‡Œ 

        // likeButton.onStateChange = (oldEl, newEl) => { 
        //     wrapper.insertBefore(newEl, oldEl) // åœ¨oldEl ä¹‹å‰ æ’å…¥æ–°çš„å…ƒç´  
        //     wrapper.removeChild(oldEl) //åˆ é™¤æ—§çš„å…ƒç´  
        
        // }

    </script>
</body>
</html>